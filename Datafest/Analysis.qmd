---
title: "Idea 2"
author: "Sonya Eason"
format: pdf
editor: visual
---


```{r}
library(tidyverse)
library(patchwork)
library(lmerTest)
library(knitr)
library(broom)
```



```{r}
unemployment <- read_csv("data/Unemployment.csv")
price <- read_csv("data/Price and Availability Data.csv")
occupancy <- read_csv("data/Major Market Occupancy Data-revised.csv")
leases <- read_csv("data/Leases.csv")
income <- read_csv("data/ACSST5Y2023.S2411-Data.csv", skip = 1)
```



#sublet less

sublet availability and square footage

Is there association between sublet and leasing SF?

```{r}
leases <- leases |>
  mutate(sublet_percent = sublet_availability_proportion *100)
```

```{r}
leases$date <- paste(leases$year, leases$monthsigned, sep = "-")
```

```{r}
mod <- lmerTest::lmer(
  leasedSF ~ sublet_percent + (1|date),  
  data = leases
)

```

```{r}
summary(mod)
```



```{r}
lmm <- function(x){
  x*2750.12 + 3988.15
}


df <- data.frame(date = leases$date, sublet_percent = leases$sublet_percent, predleasedSF = lmm(leases$sublet_percent), leasedSF = leases$leasedSF)

df <- df |>
  filter(!is.na(sublet_percent)) |>
  filter(!is.na(predleasedSF))
```

why is facet wrap low.........

make one diagram showing noise from lmm



```{r}
markets_internal <- leases |>
  filter(!is.na(market)) |>
  filter(!is.na(internal_class)) |>
  filter(!is.na(sublet_availability_proportion)) |>
  group_by(market, internal_class) |>
  summarize(
    city = first(market),
    count = n(),
    sublet_percent = first(sublet_availability_proportion)*100,
    avsqft = mean(leasedSF)
  )
```


```{r}
markets_internal
```



```{r}
ggplot(markets_internal, aes(sublet_percent, avsqft)) +
  geom_point()+
  geom_smooth(method = "lm")
```

```{r}

ggplot(markets_internal, aes(sublet_percent, avsqft)) +
  geom_point(color = "#69b3a2", size = 2, alpha = 0.6) +  # soft teal points
  geom_smooth(method = "lm", color = "#404080", fill = "#b0c4de", se = TRUE, linetype = "solid", linewidth = 1.2) +  # smooth line
  theme_minimal(base_size = 14) +  # clean minimal theme with slightly larger font
  labs(
    title = "Relationship between Sublet Percent 
    and Average Sqft",
    x = "Sublet Percent (%)",
    y = "Average Sqft",
    caption = "Source: Data Demons"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 13, margin = margin(b = 10)),
    axis.title = element_text(face = "bold"),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_blank(),
    plot.caption = element_text(size = 9, color = "gray40")
  )

```


```{r}

# Plot the data and the fitted regression lines
df |>
  filter(date%in%c("2024-12", "2024-11", "2024-10")) |>
  ggplot(aes(x = sublet_percent, y = leasedSF)) +
  geom_point(aes(color = factor(date)), alpha = 0.4, size = 0.5) +
  geom_line(aes(y = predleasedSF), color = "blue", size = 1.5)+
  #facet_wrap(~date)+
  theme_minimal() +
  coord_cartesian(ylim = c(-10000, 100000)) + 
  scale_x_continuous(limits = c(0, 100)) + # or whatever range makes sense
# <-- adjust this range as needed
  labs(
    title = "Relationship between Sublet Percentage and Leased SF",
    subtitle = "by date",
    x = "Sublet Percent",
    y = "Leased SF",
    color = "Date"
  )


```

We use a mixture model, which serves to control for confounding variables that could potentially affect the relationship we're trying to understand. Here, this is useful because we are able to control for time. 


```{r}
library(ggplot2)
library(dplyr)

# Create the summary data
df <- data.frame(
  company_type = c("Tech", "Business/Managerial/Consulting"),
  percent_change_in_leases = c(-7, 17)
)

# Plot
ggplot(df, aes(x = company_type, y = percent_change_in_leases, fill = company_type)) +
  geom_col(width = 0.6, show.legend = FALSE) +
  geom_text(aes(label = paste0(ifelse(percent_change_in_leases > 0, "+", ""), percent_change_in_leases, "%")),
            vjust = ifelse(df$percent_change_in_leases > 0, -0.5, 1.5),
            size = 5,
            fontface = "bold") +
   scale_fill_manual(values = c(
    "Tech" = "#2a9d8f",                              # Soft teal
    "Business/Managerial/Consulting" = "#e76f51"    # Warm coral
  )) +
  labs(
    x = "",
    y = "Change in Number of Leases (%)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(size = 13, margin = margin(b = 10)),
    axis.text.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    panel.grid.major.y = element_line(color = "gray85"),
    panel.grid.minor = element_blank()
  ) +
  ylim(-10, 20)

```



```{r}
library(ggplot2)

# Data
df <- data.frame(
  company_type = c("Tech", "Business/Managerial/Consulting"),
  percent_change_in_leases = c(-7, 17)
)

# Plot
ggplot(df, aes(x = company_type, y = percent_change_in_leases, fill = company_type)) +
  geom_col(width = 0.6, show.legend = FALSE) +
  geom_text(
    aes(label = paste0(ifelse(percent_change_in_leases > 0, "+", ""), percent_change_in_leases, "%")),
    vjust = ifelse(df$percent_change_in_leases > 0, -0.5, 1.5),
    size = 5,
    fontface = "bold",
    color = "gray20"
  ) +
  scale_fill_manual(values = c(
    "Tech" = "#2a9d8f",                              # Soft teal
    "Business/Managerial/Consulting" = "#e76f51"    # Warm coral
  )) +
  labs(
    title = "Impact of $10K Salary Increase on Number of Leases",
)
```






make a visualization } -- 

```{r}
leases |>
  filter(!is.na(leasedSF)) |>
  summarize(av = mean(leasedSF))
```

```{r}
leases |>
  group_by(sublet_availability_proportion) |>
  count()
```

